ğŸ•µï¸â€â™‚ï¸ Triage Report: Nginx Connection IssuesBundle: /tmp/triage-bundle_generic_node_masked.tar.gzHostDir: triage_node_generic_maskedGenerated At: 2026-01-17 14:07:22ğŸš¨ Primary FindingRule ID: NGINX_UPSTREAM_SELINUX (Priority: P0)ğŸ”´ Root Cause: Nginx åå‘ä»£ç†è¯·æ±‚è¢« SELinux æ‹¦æˆªã€‚è§£é‡Šï¼šSELinux çš„ httpd_t ä¸Šä¸‹æ–‡é»˜è®¤ç¦æ­¢ Nginx/Apache å‘èµ·ä¸»åŠ¨çš„ç½‘ç»œè¿æ¥ï¼ˆå¦‚è¿æ¥ä¸Šæ¸¸ Tomcatï¼‰ã€‚ğŸ› ï¸ Detailed Findings & Fixes[1] SELinux Blocking Upstream Connection (P0)Symptoms:Nginx é”™è¯¯æ—¥å¿—å‡ºç° Permission denied (13)ã€‚è¯·æ±‚æ— æ³•åˆ°è¾¾ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œç›´æ¥åœ¨ Nginx å±‚é¢è¢«å†…æ ¸æ‹¦æˆªã€‚âœ… How to Fix:å…è®¸ HTTPD è¿›ç¨‹å‘èµ·ç½‘ç»œè¿æ¥ï¼šsetsebool -P httpd_can_network_connect 1
é‡å¯ Nginx æœåŠ¡ï¼šsystemctl restart nginx
ğŸ” How to Verify:æ£€æŸ¥ SELinux çŠ¶æ€ï¼šgetenforceæŸ¥çœ‹æ—¥å¿—å°¾éƒ¨ï¼štail -n 50 /var/log/nginx/error.logğŸ“„ Evidence Snippet:===== 40_nginx_error_tail.txt =====

# å…³é”®ç‰¹å¾ï¼šerrno 13 (Permission denied)
2025/12/28 01:29:07 [crit] 28920#28920: *1 connect() to <Upstream_IP>:8080 failed (13: Permission denied) while connecting to upstream, client: <Client_IP>, server: _, request: "GET / HTTP/1.1", upstream: "http://<Upstream_IP>:8080/", host: "<Nginx_Node_IP>"
...
2025/12/28 01:29:34 [crit] 28933#28933: *6 connect() to <Upstream_IP>:8080 failed (13: Permission denied) while connecting to upstream, client: <Client_IP>, server: _, request: "GET /nginx-logo.png HTTP/1.1", upstream: "http://<Upstream_IP>:8080/nginx-logo.png", host: "<Nginx_Node_IP>", referrer: "http://<Nginx_Node_IP>/"
[2] Upstream Connection Refused (P1)Symptoms:Nginx é”™è¯¯æ—¥å¿—å‡ºç° Connection refused (111)ã€‚è¯·æ±‚å·²å‘å‡ºï¼Œä½†ç›®æ ‡ç«¯å£æ‹’ç»è¿æ¥ï¼ˆé€šå¸¸æ˜¯æœåŠ¡æœªå¯åŠ¨æˆ–é˜²ç«å¢™é˜»æŒ¡ï¼‰ã€‚âœ… How to Fix:ç¡®è®¤ä¸Šæ¸¸åº”ç”¨ï¼ˆå¦‚ Tomcatï¼‰æ˜¯å¦æ­£åœ¨ç›‘å¬ 8080 ç«¯å£ã€‚æ£€æŸ¥é˜²ç«å¢™/å®‰å…¨ç»„æ˜¯å¦å…è®¸å…¥ç«™ 8080 æµé‡ã€‚ğŸ” How to Verify:æµ‹è¯•è¿é€šæ€§ï¼šcurl -I http://<upstream>:8080/æ£€æŸ¥ç«¯å£ç›‘å¬ï¼šss -lntp | grep 8080ğŸ“„ Evidence Snippet:===== 40_nginx_error_tail.txt =====

# å…³é”®ç‰¹å¾ï¼šerrno 111 (Connection refused)
# æ³¨æ„ï¼šæœ€åçš„ HEAD è¯·æ±‚æ¥è‡ª Nginx èŠ‚ç‚¹è‡ªèº« IPï¼Œå¯èƒ½æ˜¯æœ¬åœ°å¥åº·æ£€æŸ¥
2025/12/28 14:05:00 [error] 1183#1183: *2 connect() failed (111: Connection refused) while connecting to upstream, client: <Client_IP>, server: _, request: "GET / HTTP/1.1", upstream: "http://<Upstream_IP>:8080/", host: "<Nginx_Node_IP>"
...
2025/12/28 14:59:59 [error] 1602#1602: *1 connect() failed (111: Connection refused) while connecting to upstream, client: <Nginx_Node_IP>, server: _, request: "HEAD / HTTP/1.1", upstream: "http://<Upstream_IP>:8080/", host: "<Nginx_Node_IP>"
